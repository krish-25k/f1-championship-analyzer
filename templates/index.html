<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 Race Analyzer</title>
    <style>
        :root {
            --primary-red: #e60000;
            --secondary-red: #ff4444;
            --light-gray: #f8f9fa;
            --dark-gray: #212529;
            --white: #ffffff;
            --card-bg: rgba(255,255,255,0.95);
            --border-color: rgba(255,255,255,0.2);
            --header-gradient: linear-gradient(135deg, var(--primary-red), var(--secondary-red));
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)),
                       url('{{ f1_logo if f1_logo else "https://upload.wikimedia.org/wikipedia/commons/3/33/F1.svg" }}') center/cover fixed;
            color: var(--dark-gray);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header {
            background: var(--header-gradient);
            color: var(--white);
            padding: 20px 40px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            animation: slideInDown 0.8s ease-out;
        }
        @keyframes slideInDown {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        header h1 {
            margin: 0;
            font-size: 2.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        header h1 .f1-icon {
            font-size: 2.2rem;
            animation: pulse 1.5s infinite ease-in-out;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .nav-links {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .nav-links a {
            color: var(--white);
            text-decoration: none;
            padding: 10px 25px;
            border-radius: 25px;
            background: rgba(255,255,255,0.2);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            font-weight: bold;
            letter-spacing: 0.5px;
        }
        .nav-links a:hover {
            background: rgba(255,255,255,0.4);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .driver-link, .constructor-link {
            color: var(--primary-red);
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s, text-decoration 0.3s;
        }
        .driver-link:hover, .constructor-link:hover {
            color: var(--secondary-red);
            text-decoration: underline;
        }
        .container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
            flex-grow: 1;
        }
        .filters {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid var(--border-color);
            animation: fadeIn 0.6s ease-out 0.3s;
            animation-fill-mode: both;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .filters label {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--dark-gray);
        }
        .filters select {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #ccc;
            background-color: var(--white);
            font-size: 1rem;
            min-width: 120px;
            cursor: pointer;
            transition: all 0.3s ease;
            -webkit-appearance: none; /* Remove default arrow in Chrome/Safari */
            -moz-appearance: none;    /* Remove default arrow in Firefox */
            appearance: none;         /* Remove default arrow */
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M287%2C114.7L158.4%2C243.3c-2.3%2C2.3-5.2%2C3.5-8.4%2C3.5s-6.1-1.2-8.4-3.5L5.4%2C114.7c-4.5-4.5-4.5-11.7%2C0-16.2s11.7-4.5%2C16.2%2C0L145%2C214.6l123.6-123.6c4.5-4.5%2C11.7-4.5%2C16.2%2C0S291.5%2C110.2%2C287%2C114.7z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px top 50%;
            background-size: 12px auto;
        }
        .filters select:focus {
            outline: none;
            border-color: var(--primary-red);
            box-shadow: 0 0 0 3px rgba(var(--primary-red), 0.2);
        }
        .filters button {
            padding: 10px 20px;
            border-radius: 25px;
            border: none;
            background: var(--primary-red);
            color: var(--white);
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .filters button:hover {
            background: var(--secondary-red);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); /* Responsive grid */
            gap: 25px;
        }
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            border: 1px solid var(--border-color);
            animation: fadeIn 0.6s ease-out 0.4s;
            animation-fill-mode: both;
            overflow: hidden; /* For table responsiveness */
        }
        .card h2 {
            margin-top: 0;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
            color: var(--primary-red);
            font-size: 1.8rem;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }
        th, td {
            text-align: left;
            padding: 12px 10px;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: rgba(242,242,242,0.8);
            font-weight: bold;
            color: var(--dark-gray);
        }
        tr {
            transition: background-color 0.3s ease;
        }
        tr:hover {
            background-color: rgba(230, 0, 0, 0.05); /* Lighter hover for tables */
        }
        .footer {
            background: rgba(33, 37, 41, 0.95);
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            flex-shrink: 0;
        }
        .footer a {
            color: var(--secondary-red);
            text-decoration: none;
        }
        .footer a:hover {
            text-decoration: underline;
        }
        .error {
            background: rgba(255, 204, 204, 0.9);
            border: 1px solid var(--primary-red);
            border-radius: 8px;
            padding: 15px;
            color: var(--primary-red);
            text-align: center;
            margin-top: 20px;
        }
        /* Make tables scrollable on small screens */
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
    </style>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

    <header>
        <h1><span class="f1-icon">üèéÔ∏è</span> F1 Race Analyzer</h1>
        <div class="nav-links">
            <a href="/">Season Overview</a>
            <a href="/points-progression">Points Progression</a>
        </div>
    </header>

    <div class="container">
        <div class="filters">
            <label for="season">Select Season:</label>
            <select id="season" name="season" onchange="this.form.submit()">
                {% for year in seasons %}
                    <option value="{{ year }}" {% if year == selected_season %}selected{% endif %}>{{ year }}</option>
                {% endfor %}
            </select>
            </div>

        {% if error %}
            <div class="error">
                <h2>Data Notice</h2>
                <p>{{ error }}</p>
            </div>
        {% else %}
            <div class="grid">
                <div class="card">
                    <h2>üèÜ Driver Standings</h2>
                    <div id="driver-table-container" class="table-responsive">{{ driver_table|safe }}</div>
                </div>
                <div class="card">
                    <h2>üè≠ Constructor Standings</h2>
                    <div id="constructor-table-container" class="table-responsive">{{ constructor_table|safe }}</div>
                </div>
            </div>
        {% endif %}
    </div>

    <footer class="footer">
        <p>Created by <a href="https://github.com/krish-25k" target="_blank">krish-25k</a></p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const selectedSeason = {{ selected_season }};

            // Enhanced season selection - submit on change
            document.getElementById('season').addEventListener('change', function() {
                window.location.href = '/' + this.value;
            });

            // Make driver names clickable
            const driverTable = document.getElementById('driver-table-container');
            if (driverTable) {
                const rows = driverTable.querySelectorAll('table tbody tr');
                rows.forEach(row => {
                    // Check if the row has enough cells and the first cell contains text
                    if (row.cells.length > 0 && row.cells[0].textContent.trim() !== '') {
                        const driverCell = row.cells[0];
                        const driverName = driverCell.textContent.trim();
                        const link = document.createElement('a');
                        link.href = `/driver/${encodeURIComponent(driverName)}/${selectedSeason}`;
                        link.className = 'driver-link';
                        link.textContent = driverName;
                        driverCell.innerHTML = '';
                        driverCell.appendChild(link);
                    }
                });
            }

            // Make constructor names clickable
            const constructorTable = document.getElementById('constructor-table-container');
            if (constructorTable) {
                const rows = constructorTable.querySelectorAll('table tbody tr');
                rows.forEach(row => {
                    // Check if the row has enough cells and the first cell contains text
                    if (row.cells.length > 0 && row.cells[0].textContent.trim() !== '') {
                        const constructorCell = row.cells[0];
                        const constructorName = constructorCell.textContent.trim();
                        const link = document.createElement('a');
                        link.href = `/team/${encodeURIComponent(constructorName)}/${selectedSeason}`;
                        link.className = 'constructor-link';
                        link.textContent = constructorName;
                        constructorCell.innerHTML = '';
                        constructorCell.appendChild(link);
                    }
                });
            }
        });
    </script>

</body>
</html>